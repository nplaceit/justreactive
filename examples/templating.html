<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Templating example</title>
    <script src="../build/reactive.js"></script>
</head>
<body>

<div>
    <label><input type="text" id="input"></label>
</div>

<template id="example">
    <h3>Foo: {{foo}}</h3>
    <div>
        Bar list
        <ul>
            <li>{{bar}}</li>
            <li>{{bar}}</li>
            <li>{{bar}}</li>
            <li>{{bar}}</li>
        </ul>
    </div>
</template>

<script type="text/javascript">


    //Template context
    const context = Reactive.proxy({ //or .object
        foo: 1,
        bar: 'Lorem ipsum'
    });

    //Renders the template
    renderTemplate(document.body, 'example', context);


    /**
     * @param {Node} parentNode
     * @param {String} id
     * @param {Object} context
     */
    function renderTemplate(parentNode, id, context) {

        const template = document.getElementById(id),
            clone = document.importNode(template.content, true);

        applyContextToElement(clone, context);

        parentNode.appendChild(clone);

    }

    /**
     * Applies the context to the template instance
     * @param {Node} element
     * @param context
     */
    function applyContextToElement(element, context) {

        for (const node of element.childNodes) {
            switch (node.nodeType) {
                case Node.TEXT_NODE:
                    const templateText = node.textContent;
                    Reactive(() =>
                        node.textContent = applyContext(templateText, context)
                    );
                    break;
                case Node.ELEMENT_NODE:
                    applyContextToElement(node, context);
                    break;
            }
        }

    }

    /**
     * Applies the context to a text content
     * @param {String} text
     * @param {Object} context
     * @returns {XML|string|*|void}
     */
    function applyContext(text, context) {
        return text.replace(/{{([^}]+)}}/, function (match, res) {
            return context[res];
        });
    }


    setInterval(() => context.foo++, 1000 / 60);

    const input = document.getElementById('input');
    input.value = context.bar;

    input.addEventListener('keydown', function () {
        setTimeout(() => context.bar = this.value, 0);
    });

</script>

</body>
</html>